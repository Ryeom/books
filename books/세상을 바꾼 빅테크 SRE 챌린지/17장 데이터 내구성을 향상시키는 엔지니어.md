
이번 장은 데이터베이스 신뢰성 엔지니어링(DBRE)의 핵심 개념인 **내구성(durability)**에 대해 설명한다. 일반적으로 신뢰성을 가용성(availability)만으로 생각하지만, 데이터 손실을 방지하는 내구성이 훨씬 중요하다는 점을 강조한다.

#### **1. 내구성을 위한 기본 전략: 복제**

데이터 손실을 막는 가장 기본적인 방법은 **복제(Replication)**다.

- **백업:** 데이터베이스 상태 손상에 대비한 가장 기본적인 보호 수단이다. 물리적으로 분리되어 있어 운영 에러에 영향을 받지 않는다.
- **복원:** 백업의 중요한 기능이지만, 복구에 시간이 오래 걸리고 최신 데이터가 손실될 수 있다. 따라서 백업 복구 절차를 정기적으로 연습해야 한다.
- **복제 프로토콜:** 비동기, 반동기, 쿼럼/합의 프로토콜 등 다양한 복제 기술이 있으며, 시스템의 요구사항에 따라 적절한 전략을 선택해야 한다. 대용량 시스템에서는 **삭제 코딩(erasure coding)**과 같은 고급 기법을 사용해 저장소 오버헤드를 줄이면서 내구성을 높일 수 있다.
    

#### **2. 내구성 추정치와 현실의 괴리**

이론적으로 마르코프 모델을 사용해 디스크 고장률(MTTF)과 복구 시간(MTTR)을 바탕으로 매우 높은 내구성 수치를 계산할 수 있다. 예를 들어, 드롭박스는 9가 24개인 이론적 내구성을 달성했다고 한다. 그러나 이 수치는 일상적인 장애만을 고려한 것으로, 예상치 못한 블랙스완(black swan) 사건에는 무력하다.

현실에서 데이터 손실의 가장 큰 원인은 다음과 같다.

- 운영자의 실수
- 펌웨어 또는 소프트웨어 버그
- 논리적 손상 전파

#### **3. 내구성을 높이기 위한 4가지 핵심 전략**

이러한 예측 불가능한 장애로부터 시스템을 보호하기 위해 4가지 핵심 전략이 필요하다.

- **격리(Isolation):** 장애가 시스템 전체로 퍼지지 않도록 물리적, 논리적, 운영적 경계를 나누는 것이다. 드롭박스는 지리적으로 분리된 리전 간에 간단한 API(put, get)를 사용해 논리적 격리를 구현하고, 배포 프로세스를 여러 단계로 나눠 운영 격리를 강화한다.
- **보호(Protection):** 운영자의 실수와 같은 내부 위협으로부터 시스템을 보호하는 안전장치를 마련해야 한다.
    - **테스트:** 단위 테스트는 물론, 프로덕션 환경을 모방한 종단 간 통합 테스트와 **결함 주입(fault injection)**을 통해 에러를 사전에 발견해야 한다.
    - **안전장치:** 운영자의 실수를 막기 위해 접근 제어, 명령어 구문 보완, 자동화에 투자하는 것이 중요하다.
    - **복구:** 장애 발생 시 신속하게 복구할 수 있도록 **"실행 취소" 버튼**과 같은 복구 메커니즘을 시스템에 내장해야 한다.
- **검증(Validation):** 시스템의 데이터 일관성을 지속적으로 확인해 잠재적 문제를 조기에 감지해야 한다.
    - **시스템 상태 확인:** **디스크 스크러버(Disk Scrubber)**는 디스크의 내용을 검증하고, **인덱스 검색자(Index Scanner)**는 저장소 메타데이터와 실제 디스크 상태를 비교한다.
    - **검증 시스템 자체의 신뢰성:** 검증 시스템이 제대로 작동하고 있는지 확인하는 것도 중요하다. 에러를 보고하지 않는 검증 시스템은 무용지물이므로, 개발자와 분리된 팀이 검증 시스템을 구축해 객관성을 확보해야 한다.
- **자동화(Automation):** 사람의 개입을 줄여 정확성과 신뢰성을 높이는 것이다.
    - **MTTR 단축:** 자동화는 장애 발생 시 복구 시간을 단축(MTTR)하여 치명적인 장애 발생 가능성을 줄인다.
    - **운영자 피로도 감소:** 단순 반복 작업을 자동화하여 엔지니어가 중요한 문제에 집중할 수 있도록 돕는다.
    - **신뢰성 확보:** 자동화된 시스템은 사람보다 훨씬 신뢰할 수 있다. 드롭박스는 디스크 장애를 감지하고 복구하는 과정을 완전히 자동화하여 소수의 인력으로 대규모 시스템을 관리한다.

**결론적으로**, 진정한 데이터 내구성은 이론적인 복제 수치에 의존하는 것이 아니라, 예측 불가능한 사고에 대비해 **격리, 보호, 검증, 자동화**를 통합하는 것이다.