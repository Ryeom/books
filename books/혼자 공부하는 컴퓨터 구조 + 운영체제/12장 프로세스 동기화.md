# ■ 12-1 동기화란?

□ 프로세스 동기화 : 특정자원에 접근 할 때 한 개의 프로세스만 접근하게 하거나 프로세스를 올바른 순서대로 실행하게 하는 것

  ⑴ 실행순서제어 : 프로세스를 올바른 순서대로 실행하기.

  ⑵ 상호배제: 동시에 접근해서는 안되는 자원에 하나의 프로세스만 접근하게 하기.

□ 상호배제 (mutual exclusion) : 공유가 불가능한 자원의 동시사용을 피하기위해 사용하는 알고리즘.

ex. 하나의 계좌에 입금, 출금 요청을 동시에 수행하지 않기

▸ 생산자와 소비자 문제 : 생산자와 소비자를 동시에 수행하면 값이 어긋(데이터의 일관성이 깨짐)나거나 실행중 오류가 도출됨

□ 공유자원과 임계구역

▸ 공유자원 (shared resource) : 공동으로 사용하는 자원. 전역변수, 파일, 입출력장치, 보조기억장치 등.. (계좌잔액 등)

▸ 임계구역 (critical section) : 동시에 실행하면 문제가 발생하는 자원에 접근하는 코드영역.

두개 이상의 프로세스가 임계구역에 진입하고자 하면 둘중하나는 대기해야한다. 임계구역에 먼저 진입한 프로세스의 작업이 마무리되면 그제서야 비로소 기다렸던 프로세스가 임계구역에 진입함.


▸ 레이스 컨디션 (race condition) : 두 개 이상의 프로세스가 동시에 실행되면 안되는 영역이지만, 잘못된 실행으로 인해 여러 프로세스가 동시다발적으로 임계구역의 코드를 실행하여 문제가 발생하는 경우.

▸ 운영체제가 임계구역 문제를 해결하는 원칙 3가지

  ⑴ 상호배제 (mutual exclusion): 한 프로세스가 임계구역에 진입했다면 다른 프로세스는 임계구역에 들어올 수 없다.

  ⑵ 진행 (progress) : 임계구역에 어떤 프로세스도 진입하지 않았다면 임계구역에 진입하고자 하는 프로세스는 들어갈 수 있어야 한다.

  ⑶ 유한대기 (bounded waiting) : 한 프로세스가 임계구역에 진입하고 싶다면 그 프로세스는 언젠가는 임계구역에 들어올 수 있어야 한다. (임계구역에 들어오기위해 무한정 대기해서는 안됨)

# ■ 12-2 동기화 기법

▸ 동기화 기법 : 임계구역에 하나의 프로세스만 진입하고, 올바른 실행순서를 보장하는 방법

□ 뮤텍스 락 (Mutex lock: MUTual EXclusion lock) ⇢ 상호배제를 위함!

동시에 접근해서는 안되는 자원에 동시에 접근하지 않도록 제어하는 것.(자물쇠 기능을 코드로 구현함)

하나의 공유자원에 접근하는 프로세스를 상정한 방식

<구현 방법>

① 자물쇠 역할 (프로세스들이 공유하는 자원인 전역 변수)

② 임계구역을 잠그는 역할 (자물쇠에 접근하지 못하도록 설정)

③ 임계구역의 잠금을 해제하는 역할 (자물쇠에 다른 프로세스들이 접근할 수 있도록 설정)

임계구역이 잠겨있을 경우 반복적으로 lock이 풀렸는지 확인하는 대기방식을 바쁜 대기(busy wait)라 칭함.

□ 세마포 (Semaphore) ⇢ 실행순서 제어

특정 조건이 만족되어야만 실행할 수 있는 상황에서 올바른 순서대로 실행하게 하는 것

공유자원이 여러개 있는 상황에서도 적용이 가능한 동기화 도구.

① 이진 세마포 (binary semaphore) : mutex와 유사함

② 카운팅 세마포 (counting semaphore) : 여러 공유자원을 다룰 수 있음.

세마포는 철도신호기에서 유래한 단어임. stop/go 프로세스는 임계구역 앞에서 멈춤신호를 받으면 잠시 기다리고 가도 좋다는 신호를 받으면 임계구역에 들어간다.

<구현방법>

1. 임계구역에 진입할 수있는 프로세스의 개수(사용 가능한 공유자원의 개수)

2. 임계구역에 들어가도 되는지 안되는지 알려주는 함수(wait)

3. 임계구역앞에서 기다리는 프로세스에 가도좋다고 신호를 주는 함수(signal)

✚ 세마포는 사용하기가 조금 불편함 ⇢ 임계구역 앞 뒤로 wait과 signal을 걸어줘야함.

### □ 모니터 (Monitor)
모니터는 공유자원과 공유자원에 접근하기위한 인터페이스(통로)를 묶어서 관리함. 프로세스는 반드시 인터페이스를 통해서만 공유자원에 접근하도록 한다.

  

### 모니터 제공 기능
1. *상호배제를 위한 동기화* : 공유자원을 다루는 인터페이스에 접근하기 위한 큐(모니터 진입큐)를 만들고 항상 하나의 프로세스만 들어오도록 함
2. *실행순서제어를 위한 동기화* : 특정조건을 바탕으로 프로세스를 실행/중단 하기위해 조건변수(condition variable; 프로세스나 스레드의 실행순서를 제어하기 위해 사용하는 특별한 변수)을 사용