
시스템이 예외 상황에서도 신뢰성과 보안을 유지할 수 있도록 설계하는 방법을 다룸. 심층방어, 구글 애플리케이션 엔진 사례, 성능 저하 제어와 같은 다양한 접근법을 설명.


## 8.1 회복성을 위한 설계 원리
회복성 설계의 핵심 원칙은 다음과 같습니다:
- 각 계층이 독립적으로 회복성을 유지하도록 설계
- 주요 기능과 비핵심 기능을 구분해 자원 배분
- 시스템의 경계를 명확히 정의하여 구획화
- 지역적 장애와 전역적 장애에 각각 대응하는 이중화
- 회복성 지표를 자동화해 실시간 대응
- 지속적으로 검증 및 개선

## 8.2 심층방어
### 트로이 목마 사례
심층방어는 다층적인 방어 체계를 통해 시스템을 보호하는 전략입니다. 트로이 목마 이야기를 통해 아래와 같은 공격 단계를 설명합니다:
1. **위협 모델링 및 취약점 탐색**: 목표와 취약점을 분석.
2. **배포**: 공격 조건을 설정.
3. **실행**: 조건에 따라 공격 감행.
4. **탈취**: 공격 성공 후 피해 완화 시도.

### 구글 애플리케이션 엔진 사례
구글 애플리케이션 엔진은 클라우드 기반 서비스로, 심층방어를 다음과 같은 방식으로 구현했습니다:
- **위험한 API 제한**: 네트워크 접근과 파일 시스템 제어를 제한.
- **런타임 계층 보안**: 네이티브 클라이언트(NaCL)로 메모리 변질을 방지하고, 샌드박스 계층으로 예상치 못한 동작을 차단.

#### 구체적 예시: 샌드박싱 계층
- **ptrace 샌드박스**: 예상치 못한 시스템 호출을 필터링.
- **NaCL 샌드박스**: 메모리 변질 및 코드 흐름 교란 방지.
- **파이썬 런타임 감사**: 불필요한 기능을 제거하고 제한된 API만 사용.

## 8.3 성능 저하의 제어
### 성능 저하를 대비한 방법
1. **비핵심 기능 비활성화**: 중요한 작업에 자원을 집중.
2. **자동화된 응답**: 쓰로틀링과 로드 셰딩을 통해 과부하 방지.
3. **사용자 경험 개선**: 장애 상황에서도 주요 기능을 유지.

### 구체적 예시: 로드 셰딩
로드 셰딩은 컴포넌트의 부하가 임계값에 도달하기 전에 우선순위가 낮은 요청을 거부해 리소스를 확보합니다.

#### 주요 효과
- 시스템 크래시를 방지.
- 요청의 중요도에 따라 정책을 설정.

### 구체적 예시: 쓰로틀링
쓰로틀링은 작업을 지연시켜 클라이언트의 요청 속도를 조정합니다. 우선순위와 처리 비용에 따라 설정 가능합니다.

## 8.4 영향 반경의 제어
### 구획화
- 시스템을 작게 나누고 각 구획을 독립적으로 유지.
- 네트워크 ACL과 VLAN을 통해 접근 제한.

### 구체적 예시: 역할 분리
서로 다른 데이터(예: 사진과 채팅 메시지)에 접근하는 마이크로서비스를 각기 다른 역할로 실행해 보안을 강화.

#### 주요 효과
- 한 구획에서의 장애가 다른 구획으로 전파되는 것을 방지.
- 장애 상황에서도 일부 구획은 정상적으로 작동.
### 위치 분리
**위치 기반 구획화**를 통해 물리적 위치와 연계된 위험을 제한합니다.
- **위치 기반 분리**: 마이크로서비스를 다른 데이터센터나 클라우드 리전에 배치.
- **위험 경계 설정**: 특정 위치에서만 접근 가능한 데이터와 키를 설정해 복호화 위험 최소화.

#### 구체적 예시: 위치 분리
1. **다른 인증서 배포**: 데이터센터별로 서로 다른 인증서를 사용.
   - 한 데이터센터에서 침입이 발생해도 신속하게 대응 가능.
2. **위치 기반 신뢰의 제약**: 
   - BeyondCorp 인프라를 통해 개별 머신과 소프트웨어를 기반으로 신뢰를 설정.
   - 중앙 인증 시스템 대신 위치별 독립 인증 시스템 사용.
### 시간 분리
**시간 기반 보안 전략**으로, 주기적으로 키와 자격 증명을 갱신해 공격자가 지속적인 접근을 어렵게 합니다.
- **키 로테이션**: 오래된 키는 만료 처리하고 새로운 키로 교체.
- **로테이션 주기 설정**: 로테이션 주기가 너무 짧거나 길지 않도록 균형 유지.

---

## 8.5 장애 도메인과 이중화
**장애의 영향을 줄이기 위한 설계 전략**:
1. **독립적 장애 도메인**: 시스템을 분리하여 하나의 장애가 전체 시스템에 영향을 미치지 않도록 설계.
2. **이중화**: 장애 발생 시 대체할 수 있는 리소스와 컴포넌트 구축.

### 구체적 예시: 장애 도메인
- **기능적 격리**: 각 장애 도메인이 독립적인 데이터 복사본을 소유.
- **데이터 검증**: 데이터 유입 시 철저히 검증하여 버그와 공격 방지.

---

## 8.6 지속적 검증
**회복성을 유지하기 위한 검증 절차**:
- **검증 집중 분야**:
  1. 호출 지연이나 리소스 부족 상황에서의 대응.
  2. 역할, 위치, 시간 구획화 경계에서의 작업 실패 확인.
- **자동화된 검증**: 검증 사례를 반복적으로 실행하며 시스템의 동작을 지속적으로 관찰.

### 구체적 예시: 검증 사례
1. **로드 셰딩과 쓰로틀링 테스트**:
   - RPC 서버에 지연이나 실패를 주입해 시스템 응답 확인.
2. **트래픽 미러링**:
   - 고가용성 컴포넌트와 원본 컴포넌트의 응답 비교.

---

## 8.7 실용적인 조언
**회복성 설계를 시작하는 방법**:
1. **기본적인 구획화와 장애 도메인 구축**:
   - 두 개의 장애 도메인만으로도 큰 이점.
2. **성능 저하와 쓰로틀링 도입**:
   - 과부하 상황을 대비한 자동화된 제어 전략.

---

## 8.8 마치며
회복성 있는 설계는 보안과 신뢰성을 동시에 강화합니다:
- **회복성의 핵심**: 시스템 장애에도 중요한 기능 유지.
- **설계 전략**: 심층방어와 이중화 도입.
- **지속적 검증**: 설계 효과를 유지하고 시스템을 지속적으로 개선.

---
#### 용어설명
- **위치 분리(Location Separation)** : 물리적 또는 지리적 위치에 따라 시스템이나 서비스의 실행을 분리하여 보안과 회복성을 강화하는 전략.
- **시간 분리(Time Separation)** : 주기적인 키 및 자격 증명 갱신을 통해 보안 위험을 줄이는 방식.
- **BeyondCorp** : 구글의 제로 트러스트 네트워크 보안 모델로, 위치 기반이 아닌 사용자와 장치의 신뢰도를 기반으로 보안을 설정하는 패러다임.
- **키 로테이션(Key Rotation)** : 보안 키를 주기적으로 교체하여 오랜 사용으로 인한 보안 취약점을 방지하는 절차.
- **장애 도메인(Failure Domain)** : 시스템 내에서 장애가 발생할 수 있는 독립적인 영역으로, 장애의 확산을 제한하기 위한 설계 개념.
- **로드 셰딩(Load Shedding)** : 시스템 부하가 과도할 때 낮은 우선순위의 작업을 중단하여 주요 서비스를 유지하는 기법.
- **쓰로틀링(Throttling)** : 클라이언트의 요청 속도를 제한하여 서버의 부하를 조절하는 기법.
- **검증(Validation)** : 시스템의 안정성과 신뢰성을 평가하기 위해 테스트와 시뮬레이션을 수행하는 과정.
- **지속적 검증(Continuous Validation)** : 시스템의 회복성과 보안을 주기적으로 점검하여 예상치 못한 상태 변화를 방지하는 작업.
- **신뢰 루트(Root of Trust)** : 보안 시스템에서 신뢰할 수 있는 하드웨어, 소프트웨어, 또는 키의 기준점.
- **기밀성 격리(Confidentiality Isolation)** : 데이터의 암호화를 통해 특정 위치나 접근 조건에서만 데이터가 읽히도록 제한하는 방법.


