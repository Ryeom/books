이 설계의 핵심은 10억 명의 일간 활성 사용자(DAU)와 최대 100만 QPS의 위치 갱신 요청을 감당하며, 정확하고(Accuracy) 효율적인(Efficiency)지도 서비스 및 경로 안내를 제공하는 것에 중점을 둠. 이는 방대한 데이터(100PB)의 관리와 실시간성 확보를 위한 기술적 선택으로 해결함.

#### 1. 핵심 목표: 대규모 실시간 위치 처리 및 효율적인 지도 전송

- 위치 갱신 부하 처리: 사용자 위치 갱신은 최대 100만 QPS의 막대한 쓰기 부하를 발생시킴. 이를 처리하기 위해 카산드라(Cassandra)와 같은 수평 확장이 용이하고 쓰기 성능이 뛰어난 NoSQL 데이터베이스를 채택함. 위치 데이터는 카프카(Kafka)를 통해 스트림 형태로 분산하여 실시간 교통 상황 분석, ETA 추정, 지도 데이터 개선 등 다양한 다운스트림 서비스에 제공하는 데이터 파이프라인 구조를 확립함.
- 지도 데이터 효율성: 총 100PB에 달하는 방대한 지도 이미지를 모바일 환경에 효율적으로 제공하는 것이 중요함. 이를 위해 미리 생성된 지도 타일을 사용자에게 가장 가까운 CDN(Content Delivery Network)을 통해 캐시하고 전송하는 전략을 사용함. 더 나아가, 압축률이 높고 모바일 화면에서 부드러운 확대/축소를 지원하는 벡터 타일(Vector Tiles)을 사용해 네트워크 대역폭 및 배터리 사용량을 최소화하는 최적화를 시도함.

#### 2. 경로 안내의 정확성 및 속도 확보

- 경로 탐색 최적화: 전 세계 도로망을 하나의 그래프로 처리하면 성능이 저하되는 문제가 발생함. 이를 극복하기 위해 도로를 계층적 경로 안내 타일이라는 관리 가능한 이진 파일(Binary File) 단위로 분할하여 객체 저장소(S3)에 보관함. 경로 탐색 시에는 A* 알고리즘의 변형을 사용하며, 필요한 타일만 메모리에 점진적으로 로드하여 메모리 요구량을 낮추고 탐색 속도를 향상시킴.
- ETA 정확도 확보: 단순 최단 거리가 아닌, 실제 예상 소요 시간(ETA)의 정확도를 높이는 것이 핵심 비즈니스 가치임. 예상 도착 시간 서비스는 카프카에서 수신하는 실시간 교통 상황 데이터와 과거 이력을 바탕으로 기계 학습(Machine Learning)을 활용하여 ETA를 산출함. 또한, 경로 안내 중 교통 상황 변화를 감지하여 경로를 재설정하거나 ETA를 갱신하는 적응형 ETA 기능은 웹소켓(WebSocket)을 통해 클라이언트에 안정적으로 전달됨.

---

## 주요 용어 정리

- 지오해싱 (Geohashing): 지도 위 특정 지리적 영역을 짧은 영문 및 숫자 문자열로 인코딩하는 체계임. 지도를 격자로 재귀적 분할하여 타일 관리, 위치 기반 검색, 데이터 분산 등에 활용함.
- 지도 타일 (Map Tile): 전체 지도를 작은 256x256 픽셀 크기의 이미지 조각으로 분할한 것임. 모바일 클라이언트가 필요한 부분만 다운로드하여 이어 붙여 지도를 표시함.
- 경로 안내 타일 (Routing Tile): 도로망 데이터를 교차로(노드)와 도로(선분)로 구성된 그래프 자료 구조로 변환한 이진 파일 단위임. 경로 탐색 알고리즘의 입력으로 사용하기 위해 계층적으로 분할하여 저장함.
- 웹 메르카토르 (Web Mercator): 구글 맵이 채택한 지도 투영법으로, 메르카토르 도법을 변형하여 웹 기반 지도 서비스에 최적화한 것임.
- 카산드라 (Cassandra): 높은 쓰기 부하와 수평적 규모 확장에 최적화된 분산 NoSQL 데이터베이스임. 초당 수백만 건에 달하는 사용자 위치 정보 갱신을 처리하는 데 적합함.
- 카프카 (Kafka): 대용량 실시간 데이터 스트림을 처리하기 위한 분산 메시징 시스템임. 사용자 위치 데이터를 실시간 교통 분석, ETA 계산 등 다양한 서비스에 비동기적으로 전달하는 파이프라인의 핵심임.
- 벡터 타일 (Vector Tile): 지도 이미지를 래스터 방식(픽셀 기반) 대신 기하학적 경로 및 다각형(벡터) 정보로 전송하는 방식임. 데이터 압축률이 우수하고 클라이언트 측에서 렌더링 품질을 유연하게 조정할 수 있음.
- 적응형 ETA (Adaptive ETA): 경로 안내 중 교통 상황 변화를 실시간으로 반영하여 예상 도착 시간을 갱신하고, 필요시 더 빠른 경로로 재안내하는 기능임.